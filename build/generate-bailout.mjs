import fs from 'fs'
import duplicateForEmbedding from 'textmate-bailout'
import {download} from 'vscode-extend-language'

export async function bailout() {
    console.log('Generating cpp bailed out grammar')
    duplicateForEmbedding({
        // url for json-version of a tmLanguage
        url: 'https://raw.githubusercontent.com/jeff-hykin/cpp-textmate-grammar/master/autogenerated/cpp.tmLanguage.json',
        appendScope: 'latex',
        bailoutPattern: '\\\\end\\{(?:minted|cppcode)\\}',
        newFileLocation: './syntaxes/cpp-grammar-bailout.tmLanguage.json'
    })

    const cppSyntaxUrl = 'https://raw.githubusercontent.com/microsoft/vscode/main/extensions/cpp/language-configuration.json'
    const cppEmbeddedSyntaxFile = './languages/latex-cpp-embedded-language-configuration.json'
    const res = await download(cppSyntaxUrl)
    if (res) {
        fs.writeFileSync(cppEmbeddedSyntaxFile, res)
    } else {
        console.log('Cannot write the content of', cppSyntaxUrl)
    }
}

